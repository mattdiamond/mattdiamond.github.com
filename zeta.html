<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Riemann Zeta partial sums</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.2/paper-core.min.js"></script>
	<script type="text/javascript">
		const SCALE_FACTOR = 100;

		function init(){
			setUpPaper();
			initZeta();
		}

		function setUpPaper(){
			myCanvas.width = window.innerWidth;
			myCanvas.height = window.innerHeight;
			paper.install(window);
			paper.setup('myCanvas');
		}

		function initZeta(){
			window.zeta = new Zeta();

			//set up GUI
			const gui = new dat.GUI();
			gui.add(zeta, 're');
			zeta.imController = gui.add(zeta, 'im').step(0.001);
			gui.add(zeta, 'imRate').step(0.001);
			gui.add(zeta, 'animate');
			gui.add(zeta, 'showPoints');
			gui.add(zeta, 'showLines');
			gui.add(zeta.gridLayer, 'visible').name('showGrid');
			gui.add(zeta, 'reset');

			zeta.draw();
		}

		function Zeta(){
			this.re = 0.5;
			this.im = 0;
			this.imRate = 1;
			this.animate = true;
			this.showPoints = false;
			this.showLines = true;
			this.gridLayer = drawGrid();
			this.reset = function(){
				this.imController.setValue(0);
			};
		}

		Zeta.prototype.draw = function(){
			new Layer();
			view.onFrame = e => {
				project.activeLayer.clear();

				const path = new Path({
					strokeColor: 'black',
					strokeWidth: 1,
					visible: this.showLines
				});
				path.add(view.center);

				if (this.animate) {
					this.im += this.imRate * e.delta;
					this.imController.updateDisplay();
				}

				const max = Math.max(Math.floor(this.im / 3), 250);
				document.getElementById('sums-count').innerText = max;

				// draw partial sums as an angle path
				let angle = 0;
				for (let n = 1; n <= max; n++) {
					// draw line relative to current point
					path.lineBy(new Point({
						angle: radToDeg(angle),
						length: n ** -this.re * SCALE_FACTOR
					}));
					if (this.showPoints) {
						new Shape.Circle({
							center: path.lastSegment.point,
							radius: 2,
							fillColor: 'black'
						});
					}
					angle += this.im * Math.log(1 + 1/n);
				}
			};
		};

		function drawGrid () {
			const xCenter = view.bounds.width / 2;
			const xCount = Math.floor(view.bounds.width / SCALE_FACTOR);
			for (let x = -xCount; x < xCount; x++){
				new Path.Line({
					from: [xCenter + x * SCALE_FACTOR, 0],
					to: [xCenter + x * SCALE_FACTOR, view.bounds.height],
					strokeColor: '#ddd',
					strokeWidth: x === 0 ? 3 : 1
				});
			}

			const yCenter = view.bounds.height / 2;
			const yCount = Math.floor(view.bounds.height / SCALE_FACTOR);
			for (let y = -yCount; y < yCount; y++) {
				new Path.Line({
					from: [0, yCenter + y * SCALE_FACTOR],
					to: [view.bounds.width, yCenter + y * SCALE_FACTOR],
					strokeColor: '#ddd',
					strokeWidth: y === 0 ? 3 : 1
				});
			}

			return project.activeLayer;
		}

		function radToDeg (angle) {
			return angle * (180 / Math.PI);
		}

		window.onload = init;
	</script>
	<style type="text/css">
		html, body {
			height: 100%;
			width: 100%;
			margin: 0;
			padding: 0;
		}

		canvas {
			float: left;
		}

		.info {
			font-family: 'Helvetica Neue', Helvetica, sans-serif;
			font-weight: 300;
			font-size: 20px;
			position: absolute;
			top: 0;
			left: 0;
			padding: 10px;
		}
	</style>
</head>
<body>
	<canvas id='myCanvas'></canvas>
	<div class='info'>
		First <span id='sums-count'></span> partial sums of the
		<a href='https://en.wikipedia.org/wiki/Riemann_zeta_function' target='_blank'>
			Riemann zeta function
		</a>
	</div>
</body>
</html>
